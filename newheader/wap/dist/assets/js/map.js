window.KaskusMap=function(){function e(e,t){_=e,b=(t||{}).location,v=(t||{}).markerIcon,T=(t||{}).onSelected,y=new google.maps.Geocoder,P=new google.maps.places.AutocompleteService}function t(e){return p(b.address).then(function(e){return m({placeId:e})})}function n(){return L().then(function(e){return m({location:e})})}function o(e){if(!_)throw"Container element is not supplied";b=e,w=new google.maps.Map(_,{center:e&&e.latLng,disableDefaultUI:!0,gestureHandling:"greedy",zoom:15}),h=new google.maps.Marker({icon:v,map:w,position:e&&e.latLng}),C=new google.maps.InfoWindow({maxWidth:300}),C.open(w,h),C.setContent(e&&e.address),i(),s()}function i(){a(),r()}function a(){var e=document.createElement("DIV");e.className+="c-map__search";var t=document.createElement("INPUT");t.setAttribute("type","text"),t.setAttribute("placeholder","Cari Lokasi");var n=document.createElement("BUTTON");n.setAttribute("type","button"),n.innerHTML="Ã—",n.onclick=function(){t.value=""},e.appendChild(t),e.appendChild(n),w.controls[google.maps.ControlPosition.TOP_CENTER].push(e),k=new google.maps.places.SearchBox(t)}function r(){B=document.createElement("BUTTON"),B.setAttribute("type","button"),B.className+="c-map__confirm",B.innerHTML="Gunakan Lokasi Ini",B.onclick=function(){b={latLng:{lat:h.getPosition().lat(),lng:h.getPosition().lng()},address:C.getContent()},T(b)},w.controls[google.maps.ControlPosition.BOTTOM_CENTER].push(B)}function s(){w.addListener("bounds_changed",function(){k.setBounds(w.getBounds())}),w.addListener("center_changed",function(){h.setPosition(w.getCenter()),c()?(l(),A()):(C.setContent("Lokasi tidak sesuai dengan Alamat Pengiriman!"),B.setAttribute("disabled",!0))}),h.addListener("click",function(){C.open(w,h)}),k.addListener("places_changed",function(){var e=k.getPlaces();if(0!=e.length&&e[0].geometry){var t=new google.maps.LatLngBounds;e[0].geometry.viewport?t.union(e[0].geometry.viewport):t.extend(e[0].geometry.location),w.fitBounds(t)}})}function c(){if(b&&b.latLngBounds){return(new google.maps.LatLngBounds).union(b.latLngBounds).contains(h.getPosition())}return!0}function u(){m({location:h.getPosition()}).then(d).catch(g)}function l(){C.setContent("Memuat Lokasi..."),B.setAttribute("disabled",!0)}function d(e){C.setContent(e.address),B.removeAttribute("disabled")}function g(e){C.setContent("Gagal memuat lokasi. Silakan coba lagi"),B.setAttribute("disabled",!0),console.err(e)}function f(e){return e.find(function(e){return e.types.indexOf("administrative_area_level_3")>=0})}function p(e){return new Promise(function(t,n){var o={input:e,types:["(cities)"],componentRestrictions:{country:"id"}};P.getPlacePredictions(o,function(e,o){if(o===google.maps.places.PlacesServiceStatus.OK){var i=f(e)||e[0];t(i.place_id)}else n("Autocomplete was not successful for the following reason: "+o)})})}function m(e){return new Promise(function(t,n){y.geocode(e,function(e,o){if(o==google.maps.GeocoderStatus.OK){var i=e[0];t({latLngBounds:i.geometry.bounds||i.geometry.viewport,latLng:i.geometry.location.toJSON(),address:i.formatted_address})}else n("Geocode was not successful for the following reason: "+o)})})}function L(){return new Promise(function(e,t){navigator.geolocation.getCurrentPosition(function(t){e({lat:t.coords.latitude,lng:t.coords.longitude})},function(e){t("Navigator error code: "+e.code)})})}var w,h,v,b,y,P,k,C,_,B,T,A=KaskusUtil.debounce(u,1e3);return e.prototype.init=function(){(b?t(b.address):n()).then(o).catch(function(e){o(),console.error(e)})},e.prototype.setLocation=function(e){b=e},e.prototype.getLocation=function(){return b},e.prototype.setMarkerIcon=function(e){v=e},e.prototype.setOnSelectedListener=function(e){T=e},e}();